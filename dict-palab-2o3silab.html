<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dictado Pro - Bosque Esmeralda</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #bbf7d0 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            overflow-x: hidden;
        }
        .input-word {
            font-size: 3.5rem;
            text-align: center;
            border-bottom: 5px solid #059669;
            color: #064e3b;
            background: transparent;
            width: 100%;
            outline: none;
            transition: all 0.3s;
        }
        .input-word:disabled {
            color: #059669;
            border-bottom-color: transparent;
        }
        .firecracker {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 100;
        }
        @keyframes particle {
            0% { transform: translate(0, 0); opacity: 1; }
            100% { transform: translate(var(--tw-x), var(--tw-y)); opacity: 0; }
        }
        .btn-green-bounce {
            box-shadow: 0 8px 0 #047857;
        }
        .btn-green-bounce:active {
            box-shadow: 0 0 0 #047857;
            transform: translateY(8px);
        }
    </style>
</head>
<body>

    <div id="main-container" class="bg-white p-8 rounded-3xl shadow-2xl w-full max-w-xl space-y-8 relative border-b-8 border-emerald-600 mx-4">
        
        <!-- Cabecera -->
        <div class="flex justify-between items-center">
            <div class="bg-emerald-600 text-white px-5 py-1.5 rounded-full font-bold text-sm">
                Palabra: <span id="count">1</span> / 500
            </div>
            <div class="text-emerald-700 font-bold flex items-center space-x-1">
                <span class="text-xs uppercase tracking-tighter">Modo Offline</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
        </div>

        <!-- Área de Audio -->
        <div class="flex flex-col items-center space-y-6">
            <button id="btn-play" class="bg-emerald-500 hover:bg-emerald-600 text-white w-32 h-32 rounded-full flex items-center justify-center shadow-lg transform transition active:scale-95 focus:outline-none btn-green-bounce">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                </svg>
            </button>
            <p class="text-emerald-800 font-medium">Toca para escuchar</p>
        </div>

        <!-- Área de Entrada -->
        <div class="space-y-4">
            <input type="text" id="input-word" class="input-word" placeholder="..." autocomplete="off" autofocus>
            <p class="text-center text-emerald-600 text-sm font-bold uppercase tracking-widest">Presiona ENTER para revisar</p>
        </div>

        <!-- Botón Siguiente -->
        <button id="btn-next" class="hidden w-full py-5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-2xl font-bold text-2xl shadow-lg transition-all btn-green-bounce">
            ¡EXCELENTE! SIGUIENTE →
        </button>
    </div>

    <script>
        // Banco de palabras ampliado
        const words = ["blusa", "brazo", "clase", "clavo", "crema", "crudo", "dragón", "dril", "fresa", "fruta", "flaco", "flota", "globo", "glaciar", "gratis", "gruta", "pluma", "plato", "primo", "presa", "trigo", "tren", "atleta", "tabla", "libro", "sobre", "cerca", "arco", "alto", "azul", "isla", "antes", "diez", "nariz", "luz", "pobre", "pueblo", "cobre", "brillo", "broche", "clima", "chicle", "claxon", "flecha", "flojo", "flauta", "glicerina", "regla", "siglo", "pleno", "soplo", "planta", "precio", "pronto", "prueba", "truco", "potro", "trapo", "trama", "triunfo", "broma", "bruma", "bravo", "bloque", "blanco", "clavel", "clínica", "cloro", "cráneo", "creer", "cristal", "cromo", "crujir", "drama", "drenar", "droga", "drástico", "frase", "freno", "frotar", "fresco", "fruncir", "flama", "fleco", "fluir", "flúor", "grado", "grano", "grito", "groso", "grupo", "pradera", "predio", "prisa", "proa", "prudente", "traje", "tregua", "trío", "trozo", "trucha"];

        let index = 0;
        let preferredVoice = null;

        const btnPlay = document.getElementById('btn-play');
        const btnNext = document.getElementById('btn-next');
        const inputWord = document.getElementById('input-word');
        const countDisplay = document.getElementById('count');

        // --- Configuración de Voz Nativa (Sin API Key) ---
        function setVoice() {
            const voices = window.speechSynthesis.getVoices();
            // Prioridad a voces femeninas o en español de México/España
            preferredVoice = voices.find(v => v.lang.startsWith('es') && /mexico|soft|helena|sabrina|pablo/i.test(v.name)) 
                             || voices.find(v => v.lang.startsWith('es')) 
                             || voices[0];
        }

        // Para navegadores que cargan voces asíncronamente
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = setVoice;
        }
        setVoice();

        function speak(text) {
            if (speechSynthesis.speaking) speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.voice = preferredVoice;
            utterance.rate = 0.85; // Un poco más lento para dictado
            utterance.pitch = 1.2; // Tono más infantil/amigable
            utterance.lang = 'es-MX';
            speechSynthesis.speak(utterance);
        }

        function removeAccents(str) {
            return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().trim();
        }

        function celebrate() {
            const colors = ['#10b981', '#34d399', '#059669', '#6ee7b7'];
            const container = document.getElementById('main-container');
            const rect = container.getBoundingClientRect();

            for (let i = 0; i < 50; i++) {
                const p = document.createElement('div');
                p.className = 'firecracker';
                p.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                const angle = Math.random() * Math.PI * 2;
                const dist = Math.random() * 250 + 50;
                p.style.setProperty('--tw-x', `${Math.cos(angle) * dist}px`);
                p.style.setProperty('--tw-y', `${Math.sin(angle) * dist}px`);
                p.style.left = '50%';
                p.style.top = '50%';
                p.style.animation = `particle 1s ease-out forwards`;
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 1000);
            }
        }

        function check() {
            const userVal = removeAccents(inputWord.value);
            const targetVal = removeAccents(words[index]);

            if (userVal === targetVal) {
                celebrate();
                btnNext.classList.remove('hidden');
                inputWord.disabled = true;
                index++;
            } else {
                inputWord.classList.add('animate-shake', 'border-red-500');
                setTimeout(() => inputWord.classList.remove('animate-shake', 'border-red-500'), 500);
            }
        }

        // Listeners
        btnPlay.addEventListener('click', () => {
            speak(words[index]);
            inputWord.focus();
        });

        btnNext.addEventListener('click', () => {
            btnNext.classList.add('hidden');
            inputWord.disabled = false;
            inputWord.value = "";
            countDisplay.innerText = index + 1;
            inputWord.focus();
            // Pequeño retraso para que no se pegue la voz al cambiar
            setTimeout(() => speak(words[index]), 300);
        });

        inputWord.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') check();
        });

        // Asegurar foco inicial
        window.onload = () => {
            setTimeout(() => inputWord.focus(), 500);
        };
    </script>

    <!-- Estilo para la animación de error -->
    <style>
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        .animate-shake { animation: shake 0.2s ease-in-out 0s 2; }
    </style>
</body>
</html>
